<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.23.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.23.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>

<div id='map'>

   <!-- The Slider -->
   <label for="chlorophyll-data">CHLOROPHYLL CONCENTRATION (1 MONTH - AQUA/MODIS)</label>
   <input type="range" min="0" step="1" max="6" value="0" id="chlorophyll-data"
       oninput="outputUpdate(value)">
   <output for="chlorophyll-data" id="volume"></output>

</div>

<script>
mapboxgl.accessToken = 'pk.eyJ1Ijoicm9ibGFicyIsImEiOiJwVlg0cnZnIn0.yhekddtKwZohGoORaWjqIw';

// Use these to keep track of which Source and Layer to delete
var previousSource = "";
var previousLayer = "";
var layerId = "";

// convenience for source and for layer names
// TODO - change to your Mapbox account name from roblabs
var rootSourceUrlLayerId = {
  "rootSourceUrl": "mapbox://roblabs.",
  "rootLayerId"  : "uniqueId-"
};

// Populate this list from those on Mapbox.com
var tilesNASAGeoTiffsLayerIds = [
  'MY1DMM_CHLORA_2016-01',
  'MY1DMM_CHLORA_2016-02',
  'MY1DMM_CHLORA_2016-03',
  'MY1DMM_CHLORA_2016-04',
  'MY1DMM_CHLORA_2016-05',
  'MY1DMM_CHLORA_2016-06',
  'MY1DMM_CHLORA_2016-07'
];

/**
 * Initialize a new map
 */
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/satellite-v9',
    zoom: 0,
    center: [0,0]
});

/**
 * load -
 * Fired immediately after all necessary resources have been downloaded
 * and the first visually complete rendering of the map has occurred.
 */
map.on('load', function () {
  switchLayer(0);
});

function switchLayer(layer) {
    layerId = tilesNASAGeoTiffsLayerIds[layer];
    document.querySelector('#volume').value = layerId;

    /*
      Update sources and layers
    */

    try {
      currentSource = rootSourceUrlLayerId.rootSourceUrl + layerId;
      map.addSource(currentSource, {
            "url": currentSource,
            "type": "raster"
          });
    } catch(err) {
      console.log(err.message);
    }

    currentLayer = rootSourceUrlLayerId.rootLayerId + layerId;
    map.addLayer({
        "id": currentLayer,
        "type": "raster",
        "source": currentSource,
        "interactive": true,
        "layout": {
            "visibility": "visible"
        }
    });

    /*
      Clean up older layers
    */

    // Remove older layer
    try {
      map.removeLayer(previousLayer);
    } catch(err) {
      console.log(err.message);
    } finally {
      previousLayer = currentLayer;
    }

}


function outputUpdate(sliderIndex) {
  document.querySelector('#volume').value = tilesNASAGeoTiffsLayerIds[sliderIndex];
  console.log(tilesNASAGeoTiffsLayerIds[sliderIndex]);
  switchLayer(sliderIndex);
}

</script>

</body>
</html>
